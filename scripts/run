#!/bin/bash

cd `git rev-parse --show-toplevel`

buck build main

# For some reason, specifying the bundle in a relative way fails:
#     -Dosgi.bundles=reference:file:./buck-out/gen/src/com/bolinfest/jdt/main.jar@start \

# TODO(bolinfest): Add the following back in once the below starts up cleanly.
# "-Dosgi.bundles=reference:file:${PWD}/buck-out/gen/src/com/bolinfest/jdt/main.jar@start"

# The list of osgi.bundles was empirically determined to be the dependencies of org.eclipse.jdt.core.
java \
  -Declipse.ignoreApp=true \
  "-Dosgi.bundles=org.eclipse.jdt.core@1:start,\
org.eclipse.core.resources,\
org.eclipse.core.expressions,\
org.eclipse.core.expressions,\
org.eclipse.core.runtime,\
org.eclipse.equinox.common,\
org.eclipse.core.jobs,\
org.eclipse.equinox.registry,\
org.eclipse.equinox.preferences,\
org.eclipse.core.contenttype,\
org.eclipse.equinox.app,\
org.eclipse.core.filesystem,\
org.eclipse.text,\
com.ibm.icu,\
org.eclipse.core.commands" \
  -jar \
    plugins/org.eclipse.osgi_3.10.100.v20150129-2253.jar \
  -consoleLog
